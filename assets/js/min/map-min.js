"use strict";L.mapbox.accessToken="pk.eyJ1IjoiYWxleGFuZGVyZ3VnZWwiLCJhIjoiTHF6V3lBdyJ9.azWklrByWOL7jmYb0KSRdQ";var InteractiveVenueMap=function(e){this.container=$("#interactive-venue-map"),this.mapElement=this.container.find(".map")[0],e=e||{},e.mapboxId="alexandergugel.k21hb9dm",e.disableClusteringAtZoom=e.disableClusteringAtZoom||8,e.zoomControl=!1,e.scrollWheelZoom=!1,this.options=e,this._initMap(e),this._initClusterGroup()};InteractiveVenueMap.prototype._initMap=function(e){this.map=L.mapbox.map(this.mapElement,e.mapboxId,e),this.zoomControl=L.control.zoom({position:"topright"}),this.zoomControl.addTo(this.map)},InteractiveVenueMap.prototype._clusterToMarkers=function(e){for(var t=e._markers.slice(),n=e._childClusters,r=0;r<n.length;r++)t=t.concat(this._clusterToMarkers(n[r]));return t},InteractiveVenueMap.prototype._initCategoryFilter=function(){$(this.id).find(".category-filter").empty()},InteractiveVenueMap.prototype._initClusterGroup=function(){var e=this;this.venueClusterGroup=new L.MarkerClusterGroup({disableClusteringAtZoom:this.options.disableClusteringAtZoom,iconCreateFunction:function(t){return new L.divIcon({iconSize:L.point(56,function n(){var e=t.getChildCount();return e%2!==0&&e++,e/=2,26*e+4}()),className:"venue-marker",html:function(){for(var n="",r=e._clusterToMarkers(t),o=0;o<r.length;o++)n+=e._venueToMarkerHTML(r[o]._venue);return n}()})}}),this.map.addLayer(this.venueClusterGroup)},InteractiveVenueMap.prototype._jumpTo=function(e,t,n){e&&t&&n&&(t.closePopup(),this.venueClusterGroup.zoomToShowLayer(n,function(){n.openPopup()}))},InteractiveVenueMap.prototype._venueToPopup=function(e){var t=this,n=$("<header />"),r=$("<h1 />");n.append(r);var o=$("<main />"),a=$("<p />");o.append(a);var i=$("<div />");i.append(n),i.append(o),a.text(e.description),r.text(e.name),n.css({background:"url("+e.image+")"});var u=this.venues.indexOf(e),s=$('<a href="#" class="previous-venue">&laquo; Previous</a>').click(function(n){var r=t.venues[u-1];t._jumpTo(t.map,e._marker,r._marker)}),p=$('<span class="progress">'+(u+1)+"/"+this.venues.length+"</span>"),c=$('<a href="#" class="next-venue">Next &raquo;</a>').click(function(n){var r=t.venues[u+1];t._jumpTo(t.map,e._marker,r._marker)});return p.append(s),p.append(c),o.append(p),i[0]},InteractiveVenueMap.prototype._venueToMarkerHTML=function(e){var t="";return t+='<div class="venue" style="background: '+e._category.color+'">',t+=e._subCategory.icon?'<img src="'+e._subCategory.icon+'">':"",t+="</div>"},InteractiveVenueMap.prototype._venueToMarker=function(e){var t=L.marker(new L.LatLng(e.lat,e.lng),{icon:L.divIcon({popupAnchor:L.point(0,-15),iconSize:L.point(30,30),className:"venue-marker",html:this._venueToMarkerHTML(e)}),title:e.name});t._venue=e,e._marker=t,t.bindPopup(this._venueToPopup(e),{}),this.venueClusterGroup.addLayer(t)},InteractiveVenueMap.prototype.render=function(e){this.venues=[],this.categories=e;for(var t=0;t<e.length;t++)for(var n=e[t],r=0;r<n.subCategories.length;r++)for(var o=n.subCategories[r],a=0;a<o.venues.length;a++)if(!n.hidden||!o.hidden){var i=o.venues[a];i._category=n,i._subCategory=o,this.venues.push(i)}for(var u=0;u<this.venues.length;u++)this._venueToMarker(this.venues[u]);this._initCategoryFilter()},InteractiveVenueMap.prototype.clearVenues=function(){delete this.categories,delete this.venues,this.venueClusterGroup.clearLayers()},InteractiveVenueMap.prototype.rerender=function(){var e=this.categories.slice();this.clearVenues(),this.render(e)};var InteractiveVenueMapModule=angular.module("InteractiveVenueMap",[]);InteractiveVenueMapModule.run(["$window",function(e){e.interactiveVenueMap=new InteractiveVenueMap,e.interactiveVenueMap.render(e.venues)}]),InteractiveVenueMapModule.controller("FilterCtrl",["$scope","$window",function(e,t){e.venues=t.venues,e.selectedCategory=e.venues[0],e.changeCategory=function(t){e.selectedCategory=t},e.toggleCategory=function(e,n){if(n)n.hidden=!n.hidden,e.hidden=!0;else{e.hidden=!e.hidden;for(var r=0;r<e.subCategories.length;r++)e.subCategories[r].hidden=!0}t.interactiveVenueMap.rerender()},e.countVenues=function(e){for(var t=0,n=0;n<e.subCategories.length;n++)t+=e.subCategories[n].venues.length;return t};for(var n=0;n<e.venues.length;n++){var r=e.venues[n];e.toggleCategory(r),e.toggleCategory(r)}}]);