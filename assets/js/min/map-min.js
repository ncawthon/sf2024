!function(){"use strict";L.mapbox.accessToken="pk.eyJ1Ijoibmlja2Nhd3Rob24iLCJhIjoiR1Vic2wwQSJ9.glVpgeji4zywDmytJ8kU8A";var b=function(a,b){this.container=$jQueryAngular("#interactive-venue-map"),this.mapElement=this.container.find(".map")[0],this._initMap(a),this._initClusterGroup(b)};b.prototype._initMap=function(a){a=a||{},a.mapboxId="nickcawthon.6eeb8650",a.zoomControl=a.zoomControl||!1,a.scrollWheelZoom=a.scrollWheelZoom||!1,a.touchZoom=a.touchZoom||!1,this.map=L.mapbox.map(this.mapElement,a.mapboxId,a),L.control.zoomslider({position:"topleft"}).addTo(this.map),L.control.fullscreen({position:"topleft"}).addTo(this.map),new L.Control.MiniMap(L.mapbox.tileLayer("nickcawthon.17457827"),{position:"topright",toggleDisplay:!1,zoomLevelOffset:-5,zoomLevelFixed:!1,zoomAnimation:!1,autoToggleDisplay:!1,width:150,height:150,aimingRectOptions:{color:"#ff7800",weight:1,clickable:!1},shadowRectOptions:{color:"#000000",weight:0,clickable:!1,opacity:0,fillOpacity:0}}).addTo(this.map);var b="http://gaugedesign.com/white-logo.svg",c=[[37.595738,-122.309541],[37.705738,-122.210541]];L.imageOverlay(b,c).addTo(this.map)},b.prototype._clusterToMarkers=function(a){for(var b=a._markers.slice(),c=a._childClusters,d=0;d<c.length;d++)b=b.concat(this._clusterToMarkers(c[d]));return b},b.prototype._initCategoryFilter=function(){$jQueryAngular(this.id).find(".category-filter").empty()},b.prototype._initClusterGroup=function(a){var b=this;a=a||{},a.disableClusteringAtZoom=a.disableClusteringAtZoom||8,a.iconCreateFunction=a.iconCreateFunction||function(a){return new L.divIcon({iconSize:L.point(56,function(){var b=a.getChildCount();return 0!==b%2&&b++,b/=2,26*b+4}()),className:"venue-marker",html:function(){for(var c="",d=b._clusterToMarkers(a),e=0;e<d.length;e++)c+=b._venueToMarkerHTML(d[e]._venue);return c}()})},this.venueClusterGroup=new L.MarkerClusterGroup(a),this.map.addLayer(this.venueClusterGroup)},b.prototype._jumpTo=function(a,b,c){a&&b&&c&&(b.closePopup(),this.venueClusterGroup.zoomToShowLayer(c,function(){c.openPopup(),this.map.panBy([0,0])}.bind(this)))},b.prototype._venueToPopup=function(a){var b=this,c=$jQueryAngular("<header />"),d=$jQueryAngular("<h1 />");c.append(d);var e=$jQueryAngular("<main />"),f=$jQueryAngular("<p />");e.append(f);var g=$jQueryAngular("<div />");g.append(c),g.append(e),f.text(a.description),d.text(a.name),c.css({background:"url("+a.image+")"});var h=this.venues.indexOf(a),i=[];if(angular.forEach(window.interactiveVenueMap.venues,function(a){angular.forEach(a.subCategories,function(b){angular.forEach(b.venues,function(c){(a.hidden!==!0||b.hidden!==!0)&&i.push(c)})})}),i.length)var j=i.indexOf(a);if(j>0)var k=$jQueryAngular('<a href="#" class="previous-venue">&laquo; Previous</a>').click(function(c){c.preventDefault();var d=b.venues[h-1];return b._jumpTo(b.map,a._marker,d._marker),!1});if(j>=0&&j<i.length-1)var l=$jQueryAngular('<a href="#" class="next-venue">Next &raquo;</a>').click(function(c){c.preventDefault();var d=b.venues[h+1];return b._jumpTo(b.map,a._marker,d._marker),!1});var m=$jQueryAngular('<span class="progress">'+(h+1)+"/"+this.venues.length+"</span>");return m.append(k),m.append(l),e.append(m),g[0]},b.prototype._venueToMarkerHTML=function(a){var b="";return b+='<div class="venue" style="background: '+a._category.color+'">',b+=a._subCategory.icon?'<img src="'+a._subCategory.icon+'">':"",b+="</div>"},b.prototype._venueToMarker=function(a){var b=L.marker(new L.LatLng(a.lat,a.lng),{icon:L.divIcon({popupAnchor:L.point(0,-15),iconSize:L.point(30,30),className:"venue-marker",html:this._venueToMarkerHTML(a)}),title:a.name});b._venue=a,a._marker=b,b.bindPopup(this._venueToPopup(a),{autoPanPadding:L.point(50,200)}),this.venueClusterGroup.addLayer(b)},b.prototype.render=function(a){this.venues=[],this.categories=a;for(var b=0;b<a.length;b++)for(var c=a[b],d=0;d<c.subCategories.length;d++)for(var e=c.subCategories[d],f=0;f<e.venues.length;f++)if(!c.hidden||!e.hidden){var g=e.venues[f];g._category=c,g._subCategory=e,this.venues.push(g)}for(var h=0;h<this.venues.length;h++)this._venueToMarker(this.venues[h]);this._initCategoryFilter()},b.prototype.clearVenues=function(){delete this.categories,delete this.venues,this.venueClusterGroup.clearLayers()},b.prototype.rerender=function(){var a=this.categories.slice();this.clearVenues(),this.render(a)};var c=angular.module("InteractiveVenueMap",[]);c.run(["$window",function(a){a.interactiveVenueMap.interactiveVenueMap=new b(a.interactiveVenueMap.mapOptions,a.interactiveVenueMap.clusterOptions),a.interactiveVenueMap.interactiveVenueMap.render(a.interactiveVenueMap.venues)}]),c.controller("FilterCtrl",["$scope","$window",function(a,b){a.venues=b.interactiveVenueMap.venues,a.selectedCategory=a.venues[0],a.changeCategory=function(b){a.selectedCategory=b},a.toggleCategory=function(a,c){if(c)c.hidden=!c.hidden,a.hidden=!0;else{a.hidden=!a.hidden;for(var d=0;d<a.subCategories.length;d++)a.subCategories[d].hidden=!0}b.interactiveVenueMap.interactiveVenueMap.rerender()},a.countVenues=function(a){for(var b=0,c=0;c<a.subCategories.length;c++)b+=a.subCategories[c].venues.length;return b};for(var c=0;c<a.venues.length;c++){var d=a.venues[c];d.disabled&&a.toggleCategory(d)}}])}.call(this,jQuery);