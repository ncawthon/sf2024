(function($){"use strict";function e(e){return $("<div/>").text(e).html()}function a(a){if(!a.entities)return e(a.text);var n={};$.each(a.entities.urls,function(a,t){n[t.indices[0]]=[t.indices[1],function(a){return"<a href='"+e(t.url)+"'>"+e(a)+"</a>"}]}),$.each(a.entities.hashtags,function(a,t){n[t.indices[0]]=[t.indices[1],function(a){return"<a href='http://twitter.com/search?q="+escape("#"+t.text)+"'>"+e(a)+"</a>"}]}),$.each(a.entities.user_mentions,function(a,t){n[t.indices[0]]=[t.indices[1],function(a){return"<a title='"+e(t.name)+"' href='http://twitter.com/"+e(t.screen_name)+"'>"+e(a)+"</a>"}]});var t="",i=0,r=0;for(r=0;r<a.text.length;++r){var s=n[r];if(s){var d=s[0],u=s[1];r>i&&(t+=e(a.text.substring(i,r))),t+=u(a.text.substring(r,d)),r=d-1,i=d}}return r>i&&(t+=e(a.text.substring(i,r))),t}var n=["blue","brown","red","green"],t=function(){return n[Math.floor(Math.random()*n.length)]},i=function(e){g.fadeOut();var a=C.find("video")[0];a&&a.pause(),C.empty()},r=function(e){"string"==typeof e&&(e=new Date(e));var a=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];return a[e.getMonth()]+" "+(e.getDay()+1)},s=function(e){return $('<div class="author"><a href="'+e.url+'" class="avatar-container"><img src="'+e.image+'"></a><div><a href="'+e.url+'">@'+e.username+'</a><span class="location">'+e.location+"</span></div></div>")},d=function(e){return function(){g.fadeIn();var n=$("<main />");n.addClass(t()),n.append('<span class="close">✖</span>'),n.append('<img src="'+e.entities.media[0].media_url+'">'),n.append(u(e)),n.append("<p>"+a(e)+"</p>"),n.append('<div class="date">'+r(e.created_at)+"</div>"),C.empty().append(n).fadeIn()}},u=function(e){return s({url:"http://twitter.com/"+e.user.screen_name,image:e.user.profile_image_url,username:e.user.screen_name,location:e.user.location})},o=function(e){var n=$("<section />");n.addClass("pure-u-1-1 pure-u-sm-1-2 pure-u-md-1-6 tile").addClass(t());var i=$("<div />").addClass("content").html(a(e));return n.append(i),e.entities&&e.entities.media&&e.entities.media.length>0&&(i.empty().addClass("image").css({background:"url("+e.entities.media[0].media_url+")"}),i.click(d(e))),n.append(u(e)),n},p=function(e){return s({url:"http://instagram.com/"+e.data.user.username,image:e.data.user.profile_picture,username:e.data.user.username,location:e.data.location||""})},c=function(e){return function(){g.fadeIn();var a=$("<main />");a.addClass(t()),a.append('<span class="close">✖</span>'),a.append('<img src="'+e.data.images.standard_resolution.url+'">'),a.append(p(e)),a.append("<p>"+$("<div />").text(e.data.caption.text).html()+"</p>"),a.append('<div class="date">'+r(new Date(1e3*e.data.created_time))+"</div>"),C.empty().append(a).fadeIn()}},l=function(e){var a=$("<section />");a.addClass("pure-u-1-1 pure-u-sm-1-2 pure-u-md-1-6 tile").addClass(t());var n=$("<div />").addClass("content");return a.append(n),n.addClass("image").css({backgroundImage:"url("+e.data.images.standard_resolution.url+")"}),n.click(c(e)),a.append(p(e)),a},f=function(e){return s({url:"http://vine.co/"+e.vanityUrls[0],image:e.avatarUrl,username:e.username,location:""})},m=function(e){return function(){g.fadeIn();var a=$("<main />");a.addClass(t()),a.append('<span class="close">✖</span>'),a.append('<video controls><source src="'+e.videoUrl+'" type="video/mp4"></video>'),a.append(f(e)),a.append("<p>"+$("<div />").text(e.description).html()+"</p>"),a.append('<div class="date">'+r(e.created)+"</div>"),C.empty().append(a).fadeIn(),a.find("video")[0].play()}},v=function(e){var a=e.data.records[0],n=$("<section />");n.addClass("tile").addClass(t());var i=$("<div />").addClass("content");n.append(i),i.addClass("image").css({backgroundImage:"url("+a.thumbnailUrl+")"});var r=$('<i class="icon ion-play"></i>');return n.append(r),r.click(m(a)),n.append(f(a)),n},h=function(e){return e[Math.floor(Math.random()*e.length)]},g,C;$(function(){g=$("#social-connections-popup-overlay"),C=$("#social-connections-popup"),C.on("click",".close",i);for(var e=$("#social-connections"),a=window.socialConnections,n=[],t=0;6>t;t++){var r=$("<div />").addClass("pure-u-1-1 pure-u-sm-1-2 pure-u-md-1-6 container");n.push(r),e.append(r)}for(var s=[],d=function(e){for(var a=0;a<n.length;a++)if(!n[a][0].hasChildNodes())return void n[a].append(e);s.push(e)},t=0;t<a.twitter.length;t++)$.get("http://api-stuff.azurewebsites.net/api/twitter/statuses/"+a.twitter[t],function(e){d(o(e))});for(var t=0;t<a.instagram.length;t++)$.get("http://api-stuff.azurewebsites.net/api/instagram/media/"+a.instagram[t],function(e){d(l(e))});for(var t=0;t<a.vine.length;t++)$.get("http://api-stuff.azurewebsites.net/api/vine/posts/"+a.vine[t],function(e){d(v(e))});setInterval(function(){if(0!==s.length){var e=h(n),a=e.find(".tile"),t=h(s);s.splice(s.indexOf(t),1),a.removeClass("flip in").addClass("flip out").hide(),a.detach(),s.push(a),e.append(t),t.hide(),t.removeClass("flip out").addClass("flip in").show()}},Math.round(5e3*Math.random()))})}).call(this,jQuery);